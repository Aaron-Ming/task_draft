
{% extends "layout_page.html" %}

{% block data_info %}

<h2 class="sub-header animated bounceIn">资源管理清单</h2>
<div id="addresModal" class="modal fade">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">新建用户</h4>
      </div>
      <div class="modal-body">
        <form class="form-inline animated bounceInLeft" id="resform" action='/add_user'>
          <div class="form-group">
            <label for="InputName">用户</label>
            <input type="text" name="user" class="form-control" id="inputuser" placeholder="UserName">
          </div>
          <div class="form-group">
            <label for="InputPwd">密码</label>
            <input type="password" name="pwd" class="form-control" id="inputpwd" placeholder="Password">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary addBtn">保存并添加</button>
      </div>
    </div>
  </div>
</div>
<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#addresModal">新增资源</button>

<table style="margin-top:20px;" class="table table-bordered table-striped animated bounceInUp">
  <thead>
    <tr>
      <th>ID</th>
      <th>主机名</th>
      <th>CPU</th>
      <th>内存</th>
      <th>过期时间</th>
      <th>负责人</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody id="tbody-content">
  </tbody>
</table>



<script>
    $('#addresModal').find('.addBtn').on('click', function() {
        var url = '/add_res?' + $('#resform').serialize()
        console.log(url)
        $.get(url, function(res) {
            if (res == 'ok') {
                $('#resform')[0].reset()
                $('#addresModal').modal('hide')
                swal({
                    title: "666",
                    text: "恭喜恭喜，添加用户成功",
                    imageUrl: "/static/sweetalert/example/images/thumbs-up.jpg"
                })

                getlist()
            } else {
                swal("用户添加失败", "用户名不能为空哦~", "error")
                getlist()
            }
        })
        return false
    })

    function getlist() {
        var res = ''
        $.getJSON('/resinfo', function(res) {
            $.each(res, function(index, value) {
                res += '<tr><td>' + index + 1 + '</td>'
                res += '<td>' + value[1] + '</td>'
                res += '<td>' + value[2] + '</td>'
                res += '<td>' + value[3] + '</td>'
                res += '<td>' + value[4] + '</td>'
                res += '<td>' + value[5] + '</td>'
                res += '<td><button data-id="' + value[0] + '" class="btn btn-danger btn-xs delete-btn">删除</button><button type="submit" data-id="' + value[0] + '" style="margin-left:10px;" class="btn btn-warning btn-xs reset-btn" data-toggle="modal" data-target="#updateresModal">修改</button></td></tr>'
            })
            $('#tbody-content').html(res)
        })
    }
    getlist()
</script>

{% endblock %}